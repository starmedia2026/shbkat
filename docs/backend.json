{
  "entities": {
    "Card": {
      "title": "Card",
      "description": "Represents a scratch card for top-up.",
      "type": "object",
      "properties": {
        "networkId": {
          "type": "string",
          "description": "The ID of the network this card belongs to."
        },
        "categoryId": {
          "type": "string",
          "description": "The ID of the category/value of this card."
        },
        "status": {
          "type": "string",
          "description": "The status of the card.",
          "enum": [
            "available",
            "used"
          ]
        },
        "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp of when the card was added."
        },
        "usedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the card was used."
        },
        "usedBy": {
          "type": "string",
          "description": "The UID of the user who used the card."
        }
      },
      "required": [
        "networkId",
        "categoryId",
        "status",
        "createdAt"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer with their account and balance information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer, matches Firebase Auth UID."
        },
        "name": {
          "type": "string",
          "description": "The customer's full name."
        },
        "accountNumber": {
          "type": "string",
          "description": "The customer's account number."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The customer's phone number."
        },
        "location": {
          "type": "string",
          "description": "The customer's location."
        },
        "balance": {
          "type": "number",
          "description": "The customer's account balance.",
          "format": "number"
        },
        "requiresPasswordChange": {
          "type": "boolean",
          "description": "If true, the user must change their password on next login."
        }
      },
      "required": [
        "id",
        "name",
        "accountNumber",
        "phoneNumber",
        "location",
        "balance"
      ]
    },
    "Operation": {
      "title": "Operation",
      "description": "Represents a financial transaction or operation for a customer.",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of the operation.",
          "enum": [
            "transfer_sent",
            "transfer_received",
            "topup_admin",
            "purchase"
          ]
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction. Positive for income, negative for outcome."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the operation."
        },
        "description": {
          "type": "string",
          "description": "A short description of the operation, e.g., 'Transfer to John Doe' or 'Aden Net - 1GB Package'."
        },
        "status": {
          "type": "string",
          "description": "Status of the operation.",
          "enum": [
            "completed",
            "pending",
            "failed"
          ]
        },
        "cardNumber": {
          "type": "string",
          "description": "The scratch card number if the operation is a purchase."
        }
      },
      "required": [
        "type",
        "amount",
        "date",
        "description",
        "status"
      ]
    },
    "Notification": {
      "title": "Notification",
      "description": "Represents a user notification for a financial transaction or system message.",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of the notification.",
          "enum": [
            "transfer_sent",
            "transfer_received",
            "topup_admin",
            "purchase",
            "system_message"
          ]
        },
        "title": {
          "type": "string",
          "description": "The title of the notification."
        },
        "body": {
          "type": "string",
          "description": "The main content of the notification."
        },
        "amount": {
          "type": "number",
          "description": "The transaction amount related to the notification, if applicable."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the notification."
        },
        "read": {
          "type": "boolean",
          "description": "Indicates if the notification has been read by the user."
        }
      },
      "required": [
        "type",
        "title",
        "body",
        "date",
        "read"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/cards/{cardId}",
        "definition": {
          "entityName": "Card",
          "schema": {
            "$ref": "#/backend/entities/Card"
          },
          "description": "Stores scratch card data.",
          "params": [
            {
              "name": "cardId",
              "description": "The card number, used as the document ID."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer data including account number, phone number, and balance.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/operations/{operationId}",
        "definition": {
          "entityName": "Operation",
          "schema": {
            "$ref": "#/backend/entities/Operation"
          },
          "description": "Stores a log of all financial operations for a specific customer.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            },
            {
              "name": "operationId",
              "description": "The unique identifier for the operation."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/notifications/{notificationId}",
        "definition": {
            "entityName": "Notification",
            "schema": {
                "$ref": "#/backend/entities/Notification"
            },
            "description": "Stores notifications for a specific customer.",
            "params": [
                {
                    "name": "customerId",
                    "description": "The unique identifier for the customer."
                },
                {
                    "name": "notificationId",
                    "description": "The unique identifier for the notification."
                }
            ]
        }
      }
    ],
    "reasoning": "The database structure is designed to store customer information, including their account details, contact number, and balance, and to allow the application to update their balance. To ensure security and proper data segregation, each customer's data is stored under a collection named 'customers'. This structure offers a clear separation of customer records, making it easy to manage and scale customer-related operations. Furthermore, to enhance security and maintain data integrity, consider implementing Firestore security rules that restrict access to customer data based on user roles or authentication status.\n\n**Authorization Independence:**  Since all customer data is self-contained within the `customers` collection, there is no reliance on data from other collections for authorization. Security rules can be applied directly to the `customers` collection based on the user's authentication status.\n\n**QAPs Support:** The segregation strategy ensures that listing customers is secure, as the rules applied to `/customers/{customerId}` govern access to each individual customer's document. There is no mixing of different access needs within the same collection."
  }
}

    