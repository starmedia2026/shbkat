
{
  "entities": {
    "Advert": {
      "title": "Advert",
      "description": "Represents an advertisement image for the home page carousel.",
      "type": "object",
      "properties": {
        "imageUrl": {
          "type": "string",
          "description": "URL of the advertisement image."
        },
        "linkUrl": {
          "type": "string",
          "description": "Optional URL to navigate to when the ad is clicked."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the advert was added."
        }
      },
      "required": [
        "imageUrl",
        "createdAt"
      ]
    },
    "Card": {
      "title": "Card",
      "description": "Represents a scratch card for top-up.",
      "type": "object",
      "properties": {
        "networkId": {
          "type": "string",
          "description": "The ID of the network this card belongs to."
        },
        "categoryId": {
          "type": "string",
          "description": "The ID of the category/value of this card."
        },
        "status": {
          "type": "string",
          "description": "The status of the card.",
          "enum": [
            "available",
            "used"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the card was added."
        },
        "usedAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the card was used."
        },
        "usedBy": {
          "type": "string",
          "description": "The UID of the user who used the card."
        }
      },
      "required": [
        "networkId",
        "categoryId",
        "status",
        "createdAt"
      ]
    },
    "Customer": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Customer",
      "type": "object",
      "description": "Represents a customer with their account and balance information.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the customer, matches Firebase Auth UID."
        },
        "name": {
          "type": "string",
          "description": "The customer's full name."
        },
        "accountNumber": {
          "type": "string",
          "description": "The customer's account number."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The customer's phone number."
        },
        "location": {
          "type": "string",
          "description": "The customer's location."
        },
        "balance": {
          "type": "number",
          "description": "The customer's account balance.",
          "format": "number"
        },
        "accountType": {
          "type": "string",
          "description": "The type of user account.",
          "enum": [
            "user",
            "network-owner",
            "admin"
          ]
        }
      },
      "required": [
        "id",
        "name",
        "accountNumber",
        "phoneNumber",
        "location",
        "balance",
        "accountType"
      ]
    },
    "FavoriteNetwork": {
      "title": "Favorite Network",
      "description": "Represents a user's favorite network.",
      "type": "object",
      "properties": {
        "networkId": {
          "type": "string",
          "description": "The ID of the favorited network."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of when the network was favorited."
        }
      },
      "required": [
        "networkId",
        "createdAt"
      ]
    },
    "Operation": {
      "title": "Operation",
      "description": "Represents a financial transaction or operation for a customer.",
      "type": "object",
      "properties": {
        "operationNumber": {
          "type": "number",
          "description": "A user-friendly, unique 8-digit number for the operation."
        },
        "type": {
          "type": "string",
          "description": "Type of the operation.",
          "enum": [
            "transfer_sent",
            "transfer_received",
            "topup_admin",
            "purchase",
            "withdraw"
          ]
        },
        "amount": {
          "type": "number",
          "description": "The amount of the transaction. Positive for income, negative for outcome."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the operation."
        },
        "description": {
          "type": "string",
          "description": "A short description of the operation, e.g., 'Transfer to John Doe' or 'Aden Net - 1GB Package'."
        },
        "status": {
          "type": "string",
          "description": "Status of the operation.",
          "enum": [
            "completed",
            "pending",
            "failed"
          ]
        },
        "cardNumber": {
          "type": "string",
          "description": "The scratch card number if the operation is a purchase."
        }
      },
      "required": [
        "operationNumber",
        "type",
        "amount",
        "date",
        "description",
        "status"
      ]
    },
    "Notification": {
      "title": "Notification",
      "description": "Represents a user notification for a financial transaction or system message.",
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "description": "Type of the notification.",
          "enum": [
            "transfer_sent",
            "transfer_received",
            "topup_admin",
            "purchase",
            "system_message",
            "withdraw"
          ]
        },
        "title": {
          "type": "string",
          "description": "The title of the notification."
        },
        "body": {
          "type": "string",
          "description": "The main content of the notification."
        },
        "amount": {
          "type": "number",
          "description": "The transaction amount related to the notification, if applicable."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the notification."
        },
        "read": {
          "type": "boolean",
          "description": "Indicates if the notification has been read by the user."
        },
        "cardNumber": {
          "type": "string",
          "description": "The scratch card number if the notification is for a purchase."
        }
      },
      "required": [
        "type",
        "title",
        "body",
        "date",
        "read"
      ]
    },
    "AdminNotification": {
      "title": "Admin Notification",
      "description": "Represents a notification for the administrator, typically for withdrawal requests.",
      "type": "object",
      "properties": {
        "title": {
          "type": "string",
          "description": "The title of the notification, e.g., 'New Withdrawal Request'."
        },
        "body": {
          "type": "string",
          "description": "A brief summary of the notification."
        },
        "operationPath": {
          "type": "string",
          "description": "The full Firestore path to the original operation document."
        },
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who initiated the action (e.g., the network owner)."
        },
        "date": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp of the notification."
        },
        "status": {
          "type": "string",
          "description": "The status of the related operation.",
          "enum": ["pending", "completed", "failed"]
        },
        "read": {
          "type": "boolean",
          "description": "Indicates if the notification has been read by the admin."
        }
      },
      "required": ["title", "body", "operationPath", "ownerId", "date", "status", "read"]
    },
    "ThemeSettings": {
      "title": "Theme Settings",
      "description": "Stores global application theme settings.",
      "type": "object",
      "properties": {
        "primaryColor": {
          "type": "string",
          "description": "The HSL value for the primary theme color."
        }
      },
      "required": [
        "primaryColor"
      ]
    },
    "AppSettings": {
      "title": "App Settings",
      "description": "Stores global application settings like the logo.",
      "type": "object",
      "properties": {
        "logoUrl": {
          "type": "string",
          "description": "The URL for the application logo."
        },
        "shareLink": {
          "type": "string",
          "description": "The URL to be shared when a user clicks the 'Share App' button."
        },
        "supportPhoneNumber": {
          "type": "string",
          "description": "The phone number for customer support."
        }
      }
    },
    "HomeService": {
      "title": "Home Page Service",
      "description": "Represents a service item on the home page grid.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "iconUrl": {
          "type": "string",
          "description": "URL for the service icon image."
        },
        "href": {
          "type": "string"
        },
        "order": {
          "type": "number"
        }
      },
      "required": [
        "id",
        "label",
        "href",
        "order"
      ]
    },
    "HomeSettings": {
      "title": "Home Page Settings",
      "description": "Stores settings for the home page, like the service grid.",
      "type": "object",
      "properties": {
        "services": {
          "type": "array",
          "items": {
            "$ref": "#/backend/entities/HomeService"
          }
        }
      }
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/adverts/{advertId}",
        "definition": {
          "entityName": "Advert",
          "schema": {
            "$ref": "#/backend/entities/Advert"
          },
          "description": "Stores advertisement data for the home page carousel.",
          "params": [
            {
              "name": "advertId",
              "description": "The unique identifier for the advert."
            }
          ]
        }
      },
      {
        "path": "/cards/{cardId}",
        "definition": {
          "entityName": "Card",
          "schema": {
            "$ref": "#/backend/entities/Card"
          },
          "description": "Stores scratch card data.",
          "params": [
            {
              "name": "cardId",
              "description": "The card number, used as the document ID."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}",
        "definition": {
          "entityName": "Customer",
          "schema": {
            "$ref": "#/backend/entities/Customer"
          },
          "description": "Stores customer data including account number, phone number, and balance.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/operations/{operationId}",
        "definition": {
          "entityName": "Operation",
          "schema": {
            "$ref": "#/backend/entities/Operation"
          },
          "description": "Stores a log of all financial operations for a specific customer.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            },
            {
              "name": "operationId",
              "description": "The unique identifier for the operation."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores notifications for a specific customer.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            },
            {
              "name": "notificationId",
              "description": "The unique identifier for the notification."
            }
          ]
        }
      },
      {
        "path": "/customers/{customerId}/favorites/{networkId}",
        "definition": {
          "entityName": "FavoriteNetwork",
          "schema": {
            "$ref": "#/backend/entities/FavoriteNetwork"
          },
          "description": "Stores a user's favorite networks. The document ID is the network ID.",
          "params": [
            {
              "name": "customerId",
              "description": "The unique identifier for the customer."
            },
            {
              "name": "networkId",
              "description": "The unique identifier for the network."
            }
          ]
        }
      },
       {
        "path": "/admin_notifications/{notificationId}",
        "definition": {
          "entityName": "AdminNotification",
          "schema": {
            "$ref": "#/backend/entities/AdminNotification"
          },
          "description": "Stores notifications intended for the administrator, like withdrawal requests.",
          "params": [
            {
              "name": "notificationId",
              "description": "The unique identifier for the admin notification."
            }
          ]
        }
      },
      {
        "path": "/settings/theme",
        "definition": {
          "entityName": "ThemeSettings",
          "schema": {
            "$ref": "#/backend/entities/ThemeSettings"
          },
          "description": "Stores the global theme settings for the application, like the primary color. There should only be one document in this collection named 'theme'."
        }
      },
      {
        "path": "/settings/app",
        "definition": {
          "entityName": "AppSettings",
          "schema": {
            "$ref": "#/backend/entities/AppSettings"
          },
          "description": "Stores global app settings like the logo, share link, and support phone number. There should only be one document in this collection named 'app'."
        }
      },
      {
        "path": "/settings/home",
        "definition": {
          "entityName": "HomeSettings",
          "schema": {
            "$ref": "#/backend/entities/HomeSettings"
          },
          "description": "Stores home page settings like the service grid configuration. There should only be one document in this collection named 'config'."
        }
      }
    ],
    "reasoning": "The database structure is designed to store customer information, including their account details, contact number, and balance, and to allow the application to update their balance. To ensure security and proper data segregation, each customer's data is stored under a collection named 'customers'. This structure offers a clear separation of customer records, making it easy to manage and scale customer-related operations. The 'settings' collection stores global application settings like theme color, font, and now the app logo, allowing an admin to update them for all users in real-time.\n\n**Authorization Independence:**  Since all customer data is self-contained within the `customers` collection, there is no reliance on data from other collections for authorization. Security rules can be applied directly to the `customers` collection based on the user's authentication status. The `settings` collection has its own rules allowing admin writes and public reads.\n\n**QAPs Support:** The segregation strategy ensures that listing customers is secure, as the rules applied to `/customers/{customerId}` govern access to each individual customer's document. There is no mixing of different access needs within the same collection."
  }
}

    